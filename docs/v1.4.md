# V1.4 â€” Onboarding + Migration Pack + Help Center + Safe Rollbacks

## Scope
- Guided onboarding wizard for first-time value in ~30 minutes.
- Import center polish with batch tracking and rollback.
- Help Center with ru/kg articles and contextual links.
- Rollback strategy that never deletes ledger entries.

## Data model changes
- **ImportBatch**: tracks each import run (type, creator, summary, rollback metadata).
- **ImportedEntity**: mapping from batch -> created entity (type + id).
- **ImportRollbackReport**: persisted rollback report summary.
- **OnboardingProgress**: per-organization onboarding status.
- **AttributeDefinition**: add `isActive` boolean for safe deactivation on rollback.

## Flows
### Onboarding
1) Store setup (legal entity required)
2) Users setup (add at least one MANAGER/STAFF)
3) Catalog bootstrap (import or add 3 products)
4) Inventory bootstrap (set default min stock; optional quick receive)
5) Procurement (create supplier + PO draft)
6) Receive + Print (receive PO + price tags)

Progress is saved per org. Each step can be skipped except store setup.

### Import batches
- Import UI creates an ImportBatch and records created entities.
- Batch history shows status and allows admin rollback.

### Rollback
- Products created by batch are archived (not deleted).
- Barcodes created by batch are removed.
- Attribute definitions created by batch are deactivated (`isActive = false`).
- Category templates referencing deactivated attributes are removed.
- If a batch created POs:
  - Not received -> cancel.
  - Received -> create compensating ADJUST movements and then mark cancelled.
- Rollback writes AuditLog and ImportRollbackReport.

## Permissions
- Onboarding: ADMIN only.
- Import/rollback: ADMIN only.
- Help Center: all authenticated users.

## Tests
- Import batch creates mappings (ImportedEntity).
- Rollback archives products and removes barcodes.
- Rollback creates compensating movements when applicable.
- RBAC: only ADMIN can rollback.

## QA checklist
### Onboarding
- [ ] ADMIN can open `/onboarding` and see progress + step cards.
- [ ] Store step blocks completion until legal type + legal name are saved.
- [ ] Users/catalog/procurement/receive steps can be skipped without errors.
- [ ] Completing the steps (real data) shows the success card with next actions.

### Import batches + rollback
- [ ] Importing products creates a new batch in `/settings/import` history.
- [ ] Rollback confirmation shows entity counts by type.
- [ ] Rolling back a product batch archives the imported products and removes imported barcodes.
- [ ] Rolling back a received PO batch creates compensating `ADJUSTMENT` movements and cancels the PO.
- [ ] Audit log entries are written for import rollback actions.

### Help Center
- [ ] `/help` renders all articles in both `ru` and `kg`.
- [ ] Contextual `?` links open the relevant help article anchors.

### Safety
- [ ] No ledger rows are deleted during rollback (only compensating movements).
