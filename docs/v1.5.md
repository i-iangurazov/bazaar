# V1.5 — Pilot Ops Pack

## Pilot-ready checklist
- [ ] **Env vars**: `DATABASE_URL`, `NEXTAUTH_SECRET`, `NEXTAUTH_URL`, `REDIS_URL`, `JOBS_SECRET`
- [ ] **Redis required in prod**: no in-memory fallbacks
- [ ] **DB backups**: daily snapshots + point-in-time recovery enabled
- [ ] **Alerts**: health endpoint, dead-letter jobs, error rate, queue retries
- [ ] **Ops runbooks**: job retry, impersonation, support bundle export

## Support workflows
- **Impersonation (admin)**: time-limited view-as-user session with audit log.
- **Support bundle export (admin)**: org + stores + users + recent movements + POs + audit logs as JSON.
- **Feature flags (per store)**: enable/disable pilot flags with audit logging.

## Reliability
- Jobs have retry w/ exponential backoff.
- Failed jobs are stored in DeadLetterJob and visible in `/admin/jobs`.
- Redis is required in production (health shows degraded if unreachable).

## Metrics definitions
- **jobs_failed_total**: dead-lettered jobs count
- **jobs_retried_total**: retry attempts count
- **jobs_inflight**: active jobs gauge
- **onboarding_started/completed** events
- **first_product_created** event
- **first_import_completed** event
- **first_po_created/received** events
- **first_price_tags_printed** event
- **WAU per org**: orgs with events in last 7 days
- **median time-to-first-value**: onboarding_started → min(first_product/import/po_received/price_tags)

## QA checklist
- [ ] Redis required in production, app fails fast without it.
- [ ] /api/health reports db + redis status.
- [ ] Dead-letter jobs appear in `/admin/jobs` with retry/resolution.
- [ ] Support bundle export downloads JSON.
- [ ] Impersonation works, expires, and is audited.
- [ ] Feature flags update per store and are audited.
- [ ] Adoption metrics render in `/admin/metrics`.
